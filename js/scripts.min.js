"use strict";function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var s=new(Function.bind.apply(e,i));return n&&_setPrototypeOf(s,n.prototype),s}).apply(null,arguments)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(){var o={yandexMap:{mapOptions:{center:[59.93912,30.3215],zoom:17,controls:[]},placemarkCoords:[59.9391,30.32145],placemarkOptions:{iconLayout:"default#image",iconImageHref:"img/map-marker.png",iconShadow:!1,iconImageSize:[231,190],iconImageOffset:[105,-124]}},responseCodesToMessages:{400:"Неверный запрос.",403:"Доступ запрещён!",404:"Ничего не найдено…",500:"Ошибка сервера."}},c={kebabToCamel:function(e){return e.replace(/\-([a-z]{1})/g,function(e,t){return t.toUpperCase()})}},e=function(e,t){for(var n=document.querySelectorAll(e),i=0;i<n.length;i++)new t(n[i])},n=function(s){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=window.pageYOffset,a=document.querySelector(s).getBoundingClientRect().top,l=null;requestAnimationFrame(function e(t){var n=t-(l=l||t),i=Math.min(r+n*o,r+a);a<0&&(i=Math.max(r-n*o,r+a)),window.scrollTo(0,i),i!==r+a?requestAnimationFrame(e):location.hash=s})};setTimeout(function(){location.hash&&n(location.hash,3)},100);var i=!0;try{localStorage.getItem("test")}catch(e){i=!1}var h=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return parseInt(getComputedStyle(e,n)[t],10)};e('a[href^="#"]',function(){function t(e){_classCallCheck(this,t),this.element=e,this.hash=e.href.replace(/[^#]*(.*)/,"$1"),this.setListeners()}return _createClass(t,[{key:"setListeners",value:function(){var t=this;this.element.addEventListener("click",function(e){e.preventDefault(),"#"!==t.hash&&n(t.hash,3)})}}]),t}());var r=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){return!1};e instanceof HTMLElement&&((e.textContent=t)?(e.classList.remove("hidden"),n()):e.classList.add("hidden"))},t=window.location.href;"/"===t[t.length-1]&&(window.location.href=t+"index.html");var s=document.createElement("div");s.style.overflowY="scroll",s.style.width="50px",s.style.height="50px",s.style.visibility="hidden",document.body.appendChild(s);var a=s.offsetWidth-s.clientWidth;document.body.removeChild(s),e(".field",function(){function t(e){_classCallCheck(this,t),this.element=e,this.isStored=i&&e.classList.contains("field--stored"),this.setInitials(),this.setListeners()}return _createClass(t,[{key:"setInitials",value:function(){this.isStored&&(this.element.value=localStorage.getItem(this.element.name))}},{key:"setListeners",value:function(){var e=this;this.element.addEventListener("input",function(){e.inputHandler()})}},{key:"inputHandler",value:function(){var e=this.element;!this.isStored||!e.validity.valid&&e.value||localStorage.setItem(e.name,e.value)}}]),t}()),e(".button",function(){function t(e){_classCallCheck(this,t),this.element=e,this.setInitials()}return _createClass(t,[{key:"setInitials",value:function(){this.element.classList.remove("hidden")}}]),t}()),e(".modal",function(){function t(e){_classCallCheck(this,t),this.element=e,this.id=e.getAttribute("id"),this.inner=e.querySelector(".modal__inner"),this.openers=document.querySelectorAll('[data-open="'.concat(this.id,'"]')),this.closer=e.querySelector(".modal__closer"),this.offset=0,this.firstFocusable=e.querySelector("input, textarea, a, button, [tabindex]"),this.siteErrorSender=e.querySelector(".field--site-error-place"),this.setInitials(),this.setListeners()}return _createClass(t,[{key:"setInitials",value:function(){this.element.classList.add("modal--js"),this.overflowHandler()}},{key:"setListeners",value:function(){for(var t=this,e=0;e<this.openers.length;e++)this.openers[e].addEventListener("click",function(e){t.openHandler(e)});this.siteErrorSender&&document.addEventListener("keydown",function(e){!document.body.classList.contains("modal-mode")&&13===e.keyCode&&e.ctrlKey&&t.openHandler(e)}),this.closer.addEventListener("click",function(e){t.closeHandler(e)}),document.addEventListener("keydown",function(e){27===e.keyCode&&t.closeHandler(e)}),window.addEventListener("resize",function(){t.overflowHandler()}),document.addEventListener("focus",function(e){t.element.classList.contains("modal--target")&&(-1===(e.path||function(e){for(var t=[];e;)t.push(e),e=e.parentElement;return t}(e.target)).indexOf(t.element)&&t.firstFocusable.focus())},!0)}},{key:"overflowHandler",value:function(){this.inner.clientHeight>window.innerHeight?this.inner.classList.add("modal__inner--overflowed"):this.inner.classList.remove("modal__inner--overflowed")}},{key:"openHandler",value:function(e){e.preventDefault(),this.offset=window.pageYOffset,this.element.classList.add("modal--target"),document.body.classList.add("modal-mode"),document.body.style.width="calc(100% - ".concat(a,"px)"),document.body.style.top="-".concat(this.offset,"px"),e.keyCode||e.target.blur()}},{key:"closeHandler",value:function(e){e.preventDefault(),this.element.classList.remove("modal--target"),this.inner.classList.remove("form--invalid-detect"),document.body.classList.remove("modal-mode"),document.body.style.width="100%",window.scrollTo(0,this.offset)}}]),t}()),e(".post",function(){function t(e){_classCallCheck(this,t),this.element=e,this.opener=document.querySelector('[data-open="'.concat(e.parentElement.id,'"]')),this.submit=e.querySelector(".post__submit"),this.fields=e.querySelectorAll(".field"),this.messageField=e.querySelector(".field--message"),this.isSiteErrorSend=this.messageField.classList.contains("field--site-error-place"),this.setInitials(),this.setListeners()}return _createClass(t,[{key:"setInitials",value:function(){this.element.classList.remove("post--invalid-detect")}},{key:"setListeners",value:function(){var t=this;this.submit.addEventListener("click",function(){t.submitHandler()}),this.opener&&(this.opener.addEventListener("click",function(){t.openHandler()}),this.isSiteErrorSend&&document.addEventListener("keydown",function(e){13===e.keyCode&&e.ctrlKey&&t.openHandler()})),this.messageField.addEventListener("keydown",function(e){13===e.keyCode&&e.ctrlKey&&(e.preventDefault(),t.submit.click())})}},{key:"openHandler",value:function(){var e=this;if(setTimeout(function(){e.setFocus()},0),this.isSiteErrorSend){var t=window.getSelection().toString();t&&(this.messageField.value="Текст ошибки:\n".concat(t,"\n\nКомментарий к ошибке:\n"))}}},{key:"setFocus",value:function(){for(var e=-1,t=0;t<this.fields.length;t++)if(!this.fields[t].value){e=t;break}e<0&&(e=this.fields.length-1),this.fields[e].focus()}},{key:"submitHandler",value:function(){this.element.classList.add("post--invalid-detect")}}]),t}()),e(".preloader",function(){function t(e){_classCallCheck(this,t),this.element=e,this.setInitials()}return _createClass(t,[{key:"setInitials",value:function(){var e=this;c.showPreloader=function(){e.element.classList.remove("hidden")},c.hidePreloader=function(){e.element.classList.add("hidden")}}}]),t}()),e(".products",function(){function t(e){_classCallCheck(this,t),this.pageButtons=e.querySelectorAll(".pagination__button:not(.pagination__button--next)"),this.nextButton=e.querySelector(".pagination__button--next"),this.list=e.querySelector(".products__list"),this.template=this.list.querySelector("li").cloneNode(!0),this.errorPlace=e.querySelector(".products__error"),this.index=1,this.setListeners()}return _createClass(t,[{key:"setListeners",value:function(){for(var n=this,e=0;e<this.pageButtons.length;e++)this.pageButtons[e].addEventListener("click",function(e){e.preventDefault(),n.clickHandler(e)});this.nextButton.addEventListener("click",function(e){e.preventDefault();var t=n.index===n.pageButtons.length?0:n.index;n.pageButtons[t].click()})}},{key:"clickHandler",value:function(e){for(var t=0;t<this.pageButtons.length;t++)this.pageButtons[t]===e.currentTarget?this.pageButtons[t].href&&(this.pageButtons[t].removeAttribute("href"),this.index=t+1,c.showPreloader(),this.ajaxHandler()):this.pageButtons[t].setAttribute("href","#")}},{key:"ajaxHandler",value:function(){var t,n,i,s=this;t={url:"app/products.json",statusPlace:s.errorPlace,callback:function(e){s.listBuilder(e)},done:function(){c.hidePreloader()}},n=new XMLHttpRequest,i=t.done||function(){return!1},n.addEventListener("load",function(){var e="";200===n.status?t.callback(n.response):e="Ошибка ".concat(n.status,": ").concat(o.responseCodesToMessages[n.status]||n.statusText),r(t.statusPlace||null,e,i)}),n.addEventListener("error",function(){r(t.statusPlace||null,"Произошла ошибка соединения.",i)}),n.addEventListener("timeout",function(){r(t.statusPlace||null,"Запрос не успел выполниться за "+n.timeout+"мс.",i)}),n.open(t.data?"POST":"GET",t.url||window.location.href),n.responseType="json",setTimeout(function(){n.send(t.data||null)},33)}},{key:"listBuilder",value:function(e){var a=this;"string"==typeof e&&(e=JSON.parse(e));var l=e.slice(6*(a.index-1),6*a.index);a.list.innerHTML="",n("#products",10),setTimeout(function(){for(var e=0;e<l.length;e++){var t=l[e],n=a.template.cloneNode(!0),i=n.querySelector("source");i&&i.setAttribute("srcset",t.img);var s=n.querySelector(".product__img");s.setAttribute("src",t.img),s.setAttribute("alt",t.name);var o=n.querySelector(".product__link"),r=o.querySelector(".product__name");o.href=t.href,r.innerHTML=t.name,n.querySelector(".product__description").innerHTML=t.description,n.querySelector(".product__button").href=t.url,a.list.insertAdjacentElement("beforeend",n)}c.hidePreloader()},1e3)}}]),t}()),e(".range",function(){function t(e){_classCallCheck(this,t),this.block=e.querySelector(".range__block"),this.progress=this.block.querySelector(".range__progress"),this.controlMin=this.block.querySelector(".range__control-min"),this.controlMax=this.block.querySelector(".range__control-max"),this.inputMin=e.querySelector(".range__input-min"),this.inputMax=e.querySelector(".range__input-max"),this.step=+this.inputMin.step,this.initialLeft=h(this.controlMin,"left"),this.safeDistance=h(this.controlMin,"width",":before"),this.safeValue=this.safeDistance*this.step,this.setInitials(),this.setListeners()}return _createClass(t,[{key:"setInitials",value:function(){this.block.classList.remove("hidden"),this.refresh()}},{key:"setListeners",value:function(){var t=this;this.inputMin.addEventListener("change",function(e){t.changeHandler(e.target)}),this.inputMax.addEventListener("change",function(e){t.changeHandler(e.target)}),this.setControlListeners(this.controlMin),this.setControlListeners(this.controlMax)}},{key:"setControlListeners",value:function(e){var t=this;e.addEventListener("keydown",function(e){t.controlKeyHandler(e)}),e.addEventListener("mousedown",function(e){t.moveHandler(e)}),e.addEventListener("touchstart",function(e){t.moveHandler(e)})}},{key:"controlKeyHandler",value:function(e){var t=e.target===this.controlMin?this.inputMin:this.inputMax;37===e.keyCode||40===e.keyCode?(e.preventDefault(),t.value>+t.min&&(t.value=+t.value-this.step)):38!==e.keyCode&&39!==e.keyCode||(e.preventDefault(),t.value<+t.max&&(t.value=+t.value+this.step)),this.refresh(e.target)}},{key:"moveHandler",value:function(e){var l=this;e.preventDefault();var c=e.currentTarget||e.changedTouches[0],u=c===this.controlMin?this.inputMin:this.inputMax,d=e.clientX,n=function(e){var t=e.changedTouches?e.changedTouches[0].clientX:e.clientX,n=d-t,i=c.offsetLeft-n;d=t;var s=l.initialLeft,o=h(l.controlMax,"left")-l.safeDistance;c===l.controlMax&&(s=h(l.controlMin,"left")+l.safeDistance,o=+l.inputMax.max/l.step+l.safeDistance),i<s?i=s:o<i&&(i=o),c.style.left="".concat(i,"px"),u.value=(i-l.initialLeft)*l.step,l.setLimits(u);var r=c===l.controlMin?i:h(l.controlMin,"left"),a=c===l.controlMax?i:h(l.controlMax,"left");l.progress.style.left="".concat(r,"px"),l.progress.style.width="".concat(a-r,"px")},t=function e(t){t.preventDefault(),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",e),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e)},i={passive:!1};e.changedTouches?(document.addEventListener("touchmove",n,i),document.addEventListener("touchend",t,i)):(document.addEventListener("mousemove",n),document.addEventListener("mouseup",t))}},{key:"changeHandler",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=+e.value+t,i=+e.min,s=+e.max;e===this.inputMin?s=+this.inputMax.value-this.safeValue:i=+this.inputMin.value+this.safeValue,n=s<n?s:n<i?i:Math.floor(n/this.step)*this.step||this.step,e.value=n,this.refresh(e)}},{key:"refresh",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=this.inputMin.value/this.step+this.initialLeft,n=(this.inputMax.value-this.inputMin.value)/this.step;this.progress.style.width="".concat(n,"px"),this.progress.style.left="".concat(t,"px"),this.controlMin.style.left="".concat(t,"px"),this.controlMax.style.left="".concat(t+n,"px"),e&&this.setLimits(e)}},{key:"setLimits",value:function(e){e===this.inputMin||e===this.controlMin?this.inputMin.max=+this.inputMax.value-this.safeValue:this.inputMax.min=+this.inputMin.value+this.safeValue}}]),t}()),e(".tabs",function(){function t(e){_classCallCheck(this,t),this.list=e.querySelector(".tabs__list"),this.items=e.querySelectorAll(".tabs__item"),this.controlsBLock=e.querySelector(".tabs__controls"),this.controls=this.controlsBLock.querySelectorAll(".tabs__control"),this.setInitials(),this.setListeners()}return _createClass(t,[{key:"setInitials",value:function(){var t=this;this.controlsBLock.classList.remove("hidden"),this.controls[0].setAttribute("disabled",!0);for(var e=function(e){t.items[e].style.position="absolute",0<e&&(t.items[e].classList.add("hidden",!0),setTimeout(function(){t.items[e].classList.remove("hidden")},33),t.items[e].classList.add("tabs__item--hidden"))},n=0;n<this.items.length;n++)e(n);this.setParentHeight(0)}},{key:"setListeners",value:function(){var i=this;this.controlsBLock.addEventListener("click",function(e){var t=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}(i.controls,e.target);if(-1<t){for(var n=0;n<i.items.length;n++)i.items[n].classList.add("tabs__item--hidden"),i.controls[n].removeAttribute("disabled");i.items[t].classList.remove("tabs__item--hidden"),i.controls[t].setAttribute("disabled",!0),i.setParentHeight(t)}e.target.blur()})}},{key:"setParentHeight",value:function(e){this.list.style.height="".concat(this.items[e].offsetHeight,"px")}}]),t}()),e(".yandex-map",function(){function t(e){_classCallCheck(this,t),this.canvas=e.querySelector(".yandex-map__canvas"),this.fallbackImg=e.querySelector(".yandex-map__fallback-img"),this.placemarkOptions=[o.yandexMap.placemarkCoords,{hintContent:e.querySelector(".yandex-map__hint").textContent},o.yandexMap.placemarkOptions],this.setInitials()}return _createClass(t,[{key:"setInitials",value:function(){var t=this;window.ymaps.ready(function(){var e=new window.ymaps.Map(t.canvas.id,o.yandexMap.mapOptions);e.geoObjects.add(_construct(window.ymaps.Placemark,_toConsumableArray(t.placemarkOptions))),e.behaviors.disable("scrollZoom"),t.fallbackImg.classList.add("yandex-map__fallback-img--ready")})}}]),t}())}();